<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="BRMQ的开发记录，其中包括以下几点：  日常进度 问题小结 资料整理 学习总结（在开发过程中收获的知识）  本文档目的出于对BMRQ的一个记录，供自己观看，以时间轴顺序记载，写的比较简洁。">
<meta property="og:type" content="article">
<meta property="og:title" content="BRMQ记录">
<meta property="og:url" content="http://yoursite.com/2020/07/08/BRMQ/index.html">
<meta property="og:site_name" content="Lqsss&#39;s Blog">
<meta property="og:description" content="BRMQ的开发记录，其中包括以下几点：  日常进度 问题小结 资料整理 学习总结（在开发过程中收获的知识）  本文档目的出于对BMRQ的一个记录，供自己观看，以时间轴顺序记载，写的比较简洁。">
<meta property="og:image" content="http://op7scj9he.bkt.clouddn.com/%E5%9B%BE%E4%B8%80.JPG">
<meta property="og:image" content="http://op7scj9he.bkt.clouddn.com/%E5%9B%BE%E4%BA%8C.JPG">
<meta property="og:image" content="http://op7scj9he.bkt.clouddn.com/IMG_1857.JPG">
<meta property="article:published_time" content="2020-07-08T07:33:59.783Z">
<meta property="article:modified_time" content="2020-07-08T07:33:59.784Z">
<meta property="article:author" content="lqsss">
<meta property="article:tag" content="message queue">
<meta property="article:tag" content="Self study">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://op7scj9he.bkt.clouddn.com/%E5%9B%BE%E4%B8%80.JPG">

<link rel="canonical" href="http://yoursite.com/2020/07/08/BRMQ/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'default'
  };
</script>

  <title>BRMQ记录 | Lqsss's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lqsss's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/08/BRMQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blog-1257900554.cos.ap-beijing.myqcloud.com/100807cd4jj1cfzf7jkjkj.jpg">
      <meta itemprop="name" content="lqsss">
      <meta itemprop="description" content="There's no place like 127.0.0.1">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lqsss's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BRMQ记录
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-08 15:33:59" itemprop="dateCreated datePublished" datetime="2020-07-08T15:33:59+08:00">2020-07-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/distributed/" itemprop="url" rel="index"><span itemprop="name">distributed</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>4 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>BRMQ的开发记录，其中包括以下几点：</p>
<ol>
<li>日常进度</li>
<li>问题小结</li>
<li>资料整理</li>
<li>学习总结（在开发过程中收获的知识）</li>
</ol>
<p>本文档目的出于对BMRQ的一个记录，供自己观看，以时间轴顺序记载，写的比较简洁。</p>
<a id="more"></a>
<h2 id="5-8之前"><a href="#5-8之前" class="headerlink" title="5.8之前"></a>5.8之前</h2><h3 id="架构设计：参照一些现在主流mq，"><a href="#架构设计：参照一些现在主流mq，" class="headerlink" title="架构设计：参照一些现在主流mq，"></a>架构设计：参照一些现在主流mq，</h3><ol>
<li>消费群组</li>
<li>根据订阅topic pull/push</li>
<li>对topic进行分区</li>
<li>整个架构通过zookeeper来进行协同</li>
</ol>
<h3 id="想法演变"><a href="#想法演变" class="headerlink" title="想法演变"></a>想法演变</h3><p><strong>问题关键在于</strong> broker（消息代理）上搭载着我们的Raft算法，如图中部broker集群（1L2F,Raft集群通常是3个节点,1领导人，2follwer）,<strong>怎么和我们的队列来进行结合。（图中的apply过程）</strong></p>
<h3 id="最开始的想法"><a href="#最开始的想法" class="headerlink" title="最开始的想法"></a>最开始的想法</h3><p><img src="http://op7scj9he.bkt.clouddn.com/%E5%9B%BE%E4%B8%80.JPG" alt=""></p>
<ol>
<li>我们用三个节点（broker集群）仅仅只搭载Raft算法，然后用多个节点针对某一个topic进行分区（1个节点对应1个分区），然后Raft集群和消息存储节点之间进行通信，broker节点通过Raft算法保证broker集群有着4个分区的replication？</li>
</ol>
<p><strong>不行：</strong></p>
<ol>
<li>将消息存储和一致性算法分开了，目前觉得节点多而浪费。</li>
<li>如果是一个broker集群上有所有分区副本，消费者/生产者读写都通过leader，那还要分区干嘛。</li>
</ol>
<h3 id="思考了一下"><a href="#思考了一下" class="headerlink" title="思考了一下"></a>思考了一下</h3><p>topic里的消息就应该直接存储在broker上，我上面那个太蠢了，先来4个节点存储消息，再搞3个节点存储副本（每个节点都有4个分区的副本）。分区本来就是为了解决IO瓶颈问题，broker集群上存储着所有消息，每个消费者/生产者对此进行读写，性能大大有问题。</p>
<p><img src="http://op7scj9he.bkt.clouddn.com/%E5%9B%BE%E4%BA%8C.JPG" alt=""><br>参考了一下kafka，再加上我们的一致性算法保证副本一致性。<br><strong>对图的解释：</strong> 我们还是有3个节点构成broker集群，serverId分别为1、2、3，在节点的0、1、2、3代表的topic下的4个分区消息，图中一半阴影一半空白表示该节点是本分区的leader（和client通信接收指令，以及和集群其他节点通信，保证它们有着相同的分区副本）。</p>
<p>4个分区分散到三个serverId分别为1、2、3的broker集群，每个节点上都有某个分区的leader和其他分区的replication，比如id:2的节点是topic分区2的leader，也是分区0、1、3的follower，有着它们的replication。一个节点可能是多个分区的leader，比如id:1的节点是topic分区0的leader，也是分区1的leader。</p>
<p><strong>不行</strong></p>
<ol>
<li>可能需要改变Raft算法，因为我们的Raft只有一个leader，多个follower，而此处的猜想是每个分区消息对应一个leader，1个节点可能有多个分区leader。<strong>实力不够！</strong></li>
</ol>
<h3 id="最终敲定"><a href="#最终敲定" class="headerlink" title="最终敲定"></a>最终敲定</h3><p>topic下的一个分区消息存储在一个broker集群里（当然也可以多个分区存储在一个集群啦），broker集群里的每个节点有着相同的分区副本。<br><img src="http://op7scj9he.bkt.clouddn.com/IMG_1857.JPG" alt=""><br>如图，我们的producer生产一个topic-0的消息，根据zookeeper上注册的一些节点信息，producer找到了shardId为1的broker集群，接下来就是Raft的功劳啦！！</p>
<h3 id="ProtoBuf"><a href="#ProtoBuf" class="headerlink" title="ProtoBuf"></a>ProtoBuf</h3><p>学习了一下谷歌的ProtoBuf，引用到项目中。<br>记录的一篇配置文章<a href="https://lqsss.github.io/2018/05/02/protobuf/" target="_blank" rel="noopener">ProtoBuf生成</a></p>
<h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><ol>
<li>cg（consumer group）</li>
</ol>
<ul>
<li><p>作用</p>
<blockquote>
<p>引入多个consumer的初衷大多是为了提升消费性能，即提升消费的吞吐量。试想你的业务消费代码打算消费100个分区的数据，使用一个consumer消费有很大可能使得各个分区的消费进度不均匀，且单个consumer单次poll回来的数据量是有限制的，最终消费端总的TPS也受限于单consumer的性能。</p>
</blockquote>
</li>
<li><p>设定</p>
<blockquote>
<p>既然是一个组，那么组内必然可以有多个消费者或消费者实例(consumer instance)，它们共享一个公共的ID，即group ID。组内的所有消费者协调在一起来消费订阅主题(subscribed topics)的所有分区(partition)。当然，每个分区只能由同一个消费组内的一个consumer来消费。</p>
</blockquote>
</li>
</ul>
<ol start="2">
<li><p>partition<br>topic是逻辑概念，partition是物理概念，producer只关心消息发往哪个topic，而consumer只关心自己订阅哪个topic。<br>如果所有的消息处于一个broker来处理的话，那么这个broker就会成为瓶颈，无法做到水平扩展，将topic的消息分散到整个集群，也就是类似于分布式存储系统里的分片。</p>
</li>
<li><p>zookeeper<br>emmm，暂时不说。</p>
</li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://www.zhihu.com/question/28925721" target="_blank" rel="noopener">kafka中的topic为什么要进行分区?</a><br><a href="https://www.cnblogs.com/huxi2b/p/6223228.html" target="_blank" rel="noopener">Kafka消费组(consumer group)</a><br><a href="https://www.zhihu.com/question/57278539" target="_blank" rel="noopener">kafka消费者组数量较大对性能有什么影响？</a></p>
<h2 id="5-8"><a href="#5-8" class="headerlink" title="5.8"></a>5.8</h2><h3 id="进度"><a href="#进度" class="headerlink" title="进度"></a>进度</h3><ol>
<li>zookeeper单机伪集群配置</li>
<li>Curator控制zk代码编写</li>
</ol>
<ul>
<li>主要配置<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    CuratorFramework client = CuratorFrameworkFactory.builder()</span><br><span class="line">            .connectString(<span class="string">"192.168.1.109:2181"</span>)</span><br><span class="line">            .sessionTimeoutMs(<span class="number">5000</span>)</span><br><span class="line">            .connectionTimeoutMs(<span class="number">3000</span>)</span><br><span class="line">            .retryPolicy(<span class="keyword">new</span> ExponentialBackoffRetry(<span class="number">1000</span>, <span class="number">3</span>))</span><br><span class="line">            .build();</span><br><span class="line">    client.start();</span><br><span class="line">    </span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h2><a href="https://blog.csdn.net/poechant/article/details/6633923" target="_blank" rel="noopener">zookeeper入门（1）在单机上实现ZooKeeper伪机群/伪集群部署</a><br><a href="http://www.cnblogs.com/huey/p/4307724.html" target="_blank" rel="noopener">ZooKeeper(3.4.5) - 开源客户端 Curator(2.7.0) 的简单示例</a></li>
</ul>
<h3 id="收获的其他知识"><a href="#收获的其他知识" class="headerlink" title="收获的其他知识"></a>收获的其他知识</h3><p>工厂模式和构建者模式的应用场景，好奇java的内部类作用<br><a href="https://lqsss.github.io/2018/05/09/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" target="_blank" rel="noopener">factory pattern</a><br><a href="https://lqsss.github.io/2018/05/09/%E6%9E%84%E5%BB%BA%E8%80%85%E6%A8%A1%E5%BC%8F/" target="_blank" rel="noopener">builder pattern</a><br><a href="https://lqsss.github.io/2018/05/09/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%86%85%E9%83%A8%E7%B1%BB/" target="_blank" rel="noopener">内部类</a></p>
<h2 id="5-10"><a href="#5-10" class="headerlink" title="5.10"></a>5.10</h2><h3 id="进度-1"><a href="#进度-1" class="headerlink" title="进度"></a>进度</h3><ol>
<li>Broker的大致架构构思</li>
<li>ZkManager的编写</li>
</ol>
<ul>
<li>启动zkclient连接伪集群</li>
<li>RMBQ里 broker模块里 需要broker信息列表向zk注册，未来消费者生产者需要通过zk上的broker的节点信息进行沟通， /broker/shardId/xxx,xxx,xxx(xxx代表消息代理节点，shardId代表这个broker集群的分片id)，这里节点都是CreateMode.PERSISTENT。</li>
<li>zk需要保存topic。<br>/broker/topics/xxx(xxx代表zk服务端保存的主题)</li>
</ul>
<ol start="3">
<li>broker里的raft服务、状态机等注册。broker服务里有消费者pull和生产者push信息的两种服务，需要将此通过RPC（动态代理）完成</li>
</ol>
<h3 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h3><p>参考一下给出的Raft使用demo，完成</p>
<h3 id="收获知识点"><a href="#收获知识点" class="headerlink" title="收获知识点"></a>收获知识点</h3><ol>
<li>zk节点类型</li>
</ol>
<ul>
<li>CreateMode.EPHEMERAL 临时节点 跟session生命周期有关<br>临时节点下面不能创建子节点。</li>
<li>CreateMode.EPHEMERAL_SEQUENTIAL 临时顺序节点<br>分布式锁(暂时空缺)</li>
<li>CreateMode.PERSISTENT 持久节点</li>
<li>CreateMode.PERSISTENT_SEQUENTIAL 持久顺节点<br>默认的Session超时时间是在2 * tickTime ~ 20 * tickTime(心跳数)</li>
</ul>
<h3 id="参考-2"><a href="#参考-2" class="headerlink" title="参考"></a>参考</h3><p><a href="https://blog.csdn.net/jiyiqinlovexx/article/details/42649487" target="_blank" rel="noopener">ZooKeeper的“会话终止”是这么出现的</a></p>
<h2 id="5-11"><a href="#5-11" class="headerlink" title="5.11"></a>5.11</h2><p>娱乐学习了一下<br><a href="https://lqsss.github.io/2018/05/12/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-zookeeper/" target="_blank" rel="noopener">分布式锁实现 - zookeeper</a><br><a href="https://my.oschina.net/u/1540325/blog/610347" target="_blank" rel="noopener">zookeeper之监听事件总结</a></p>
<h2 id="5-12"><a href="#5-12" class="headerlink" title="5.12"></a>5.12</h2><h3 id="进度-2"><a href="#进度-2" class="headerlink" title="进度"></a>进度</h3><ol>
<li>状态机方面代码研究<br> 实现Raft提供的接口，主要完成三个方法：</li>
</ol>
<ul>
<li>writeSnapshot</li>
<li>readSnapshot</li>
<li>apply</li>
</ul>
<p>关于Raft快照这方面暂时空缺，主要来看下apply（应用到状态机上），当Raft集群中的leader确认集群中大部分节点都将此消息存入日志中，改变状态机的状态，返回client ack消息。</p>
<ol start="2">
<li>数据结构的设计（对于存储消息）<br>按照之前设定的broker架构，每一个raft集群掌管一个queueId，保证一个队列的副本一致性，这里queueId比较抽象。</li>
</ol>
<p>etc，<code>topic/queueId/xxx.log</code>,实际对应硬盘中/某个具体topic/queueId的文件夹,在具体queueId文件夹下存放着(根据一定的决策分区的)对应的消息文件，消息文件里存放着一列一列的消息请求实体(content)</p>
<p>queue对应多个segmentedLog，segmentedLog里有多个segement文件，segement里是消息实体</p>
<p><code>ConcurrentHashMap&lt;String, ConcurrentHashMap&lt;Integer, SegmentedLog&gt;&gt;</code><br>key:topic,value:也是一个ConcurrentHashMap，多个queueId对应的SegmentedLog文件夹；</p>
<p>SegmentedLog里有<code>TreeMap&lt;Long, Segment&gt;</code><br>key:存储起始offset，value:对应的Segment</p>
<p>xx/topic/queueId/start-end.log (文件名信息：存储的第一行消息在整个消息队列的offset，以及最后一行消息的offset)</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ol>
<li>zk删除父路径，若底下有子节点 会报异常</li>
<li>Curator<code>creatingParentsIfNeeded()</code> 会把前面的所有没有创建的路径全部创建一遍</li>
</ol>
<h2 id="5-13"><a href="#5-13" class="headerlink" title="5.13"></a>5.13</h2><p><strong>今天母亲节！</strong></p>
<h3 id="进度-3"><a href="#进度-3" class="headerlink" title="进度"></a>进度</h3><p>之前的快照读/写取代码先放一下，当前主要是apply。<br>LogManager管理<code>ConcurrentMap&lt;String, ConcurrentMap&lt;Integer, SegmentedLog&gt;&gt;</code>这一数据结构<br>节点启用时，读取快照，此时会进行读取messages文件夹下的文件</p>
<ol>
<li>遍历topic文件夹，对于每一个topic创建Map&lt;Integer, SegmentedLog&gt; queueMap</li>
<li>嵌套遍历，遍历1得到的当前topic底下的分区，目的：得到SegmentedLog填充queueMap</li>
<li>嵌套遍历，遍历2得到的当前分区下的segement文件，目的：新建Segement对象(根据文件名，得到在队列的offset)，填充TreeMap&lt;Long, Segment&gt; startOffsetSegmentMap<br>Raft启动时，LogManager在构造时,读取文件信息，完成这些数据结构的初始化。</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/message-queue/" rel="tag"># message queue</a>
              <a href="/tags/Self-study/" rel="tag"># Self study</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/07/08/ArrayList/" rel="prev" title="ArrayList源码分析(JDK1.8)">
      <i class="fa fa-chevron-left"></i> ArrayList源码分析(JDK1.8)
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/08/2pc/" rel="next" title="2PC">
      2PC <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-8之前"><span class="nav-number">1.</span> <span class="nav-text">5.8之前</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#架构设计：参照一些现在主流mq，"><span class="nav-number">1.1.</span> <span class="nav-text">架构设计：参照一些现在主流mq，</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#想法演变"><span class="nav-number">1.2.</span> <span class="nav-text">想法演变</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最开始的想法"><span class="nav-number">1.3.</span> <span class="nav-text">最开始的想法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#思考了一下"><span class="nav-number">1.4.</span> <span class="nav-text">思考了一下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最终敲定"><span class="nav-number">1.5.</span> <span class="nav-text">最终敲定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ProtoBuf"><span class="nav-number">1.6.</span> <span class="nav-text">ProtoBuf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他问题"><span class="nav-number">1.7.</span> <span class="nav-text">其他问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考"><span class="nav-number">1.8.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-8"><span class="nav-number">2.</span> <span class="nav-text">5.8</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#进度"><span class="nav-number">2.1.</span> <span class="nav-text">进度</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考-1"><span class="nav-number">3.</span> <span class="nav-text">参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#收获的其他知识"><span class="nav-number">3.1.</span> <span class="nav-text">收获的其他知识</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-10"><span class="nav-number">4.</span> <span class="nav-text">5.10</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#进度-1"><span class="nav-number">4.1.</span> <span class="nav-text">进度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下一步"><span class="nav-number">4.2.</span> <span class="nav-text">下一步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#收获知识点"><span class="nav-number">4.3.</span> <span class="nav-text">收获知识点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考-2"><span class="nav-number">4.4.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-11"><span class="nav-number">5.</span> <span class="nav-text">5.11</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-12"><span class="nav-number">6.</span> <span class="nav-text">5.12</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#进度-2"><span class="nav-number">6.1.</span> <span class="nav-text">进度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他"><span class="nav-number">6.2.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-13"><span class="nav-number">7.</span> <span class="nav-text">5.13</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#进度-3"><span class="nav-number">7.1.</span> <span class="nav-text">进度</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lqsss"
      src="https://blog-1257900554.cos.ap-beijing.myqcloud.com/100807cd4jj1cfzf7jkjkj.jpg">
  <p class="site-author-name" itemprop="name">lqsss</p>
  <div class="site-description" itemprop="description">There's no place like 127.0.0.1</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



            <div id="music163player">
              <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=517346741&auto=1&height=66"></iframe>
            </div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lqsss</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">NaNm</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">NaN:aN</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
